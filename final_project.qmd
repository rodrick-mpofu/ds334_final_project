---
title: "Final Project"
author: "Rodrick Mpofu"
format: 
  html:
    embed-resources: true
---

```{r Read the data}
# Read the data
library(tidyverse)
data_df <- read_csv("data/data.csv")
preprocessed_data_df <- read_csv("data/preprocessed_data.csv")
raw_fighter_df <- read_csv("data/raw_fighter_details.csv")
raw_total_fight_df <- read_delim("data/raw_total_fight_data.csv", delim = ";")
```

# Introduction

The Ultimate Fighting Championship (UFC) is the largest mixed martial arts promotion company in the world featuring most of the top-ranked fighters in the sport. The organization showcases nine weight divisions and enforces the Unified Rules of Mixed Martial Arts. The UFC produces events worldwide that showcase twelve weight divisions and abide by the Unified Rules of Mixed Martial Arts.This project aims to analyze the UFC data to provide insights into the fighters and fights. The data was obtained from [Kaggle](https://www.kaggle.com/datasets/rajeevw/ufcdata/data) and contains information on fighters, fights, and preprocessed data.

# Data Description

## The data contains the following columns:

-   `R_` and `B_` prefix signifies red and blue corner fighter stats respectively
-   `_opp_` containing columns is the average of damage done by the opponent on the fighter
-   `KD` is number of knockdowns
-   `SIG_STR` is no. of significant strikes 'landed of attempted'
-   `SIG_STR_pct` is significant strikes percentage
-   `TOTAL_STR` is total strikes 'landed of attempted'
-   `TD` is no. of takedowns
-   `TD_pct` is takedown percentages
-   `SUB_ATT` is no. of submission attempts
-   `PASS` is no. times the guard was passed?
-   `REV` is the no. of Reversals landed
-   `HEAD` is no. of significant strinks to the head 'landed of attempted'
-   `BODY` is no. of significant strikes to the body 'landed of attempted'
-   `CLINCH` is no. of significant strikes in the clinch 'landed of attempted'
-   `GROUND` is no. of significant strikes on the ground 'landed of attempted'
-   `win_by` is method of win
-   `last_round` is last round of the fight (ex. if it was a KO in 1st, then this will be 1)
-   `last_round_time` is when the fight ended in the last round
-   `Format` is the format of the fight (3 rounds, 5 rounds etc.)
-   `Referee` is the name of the Ref
-   `date` is the date of the fight
-   `location` is the location in which the event took place
-   `Fight_type` is which weight class and whether it's a title bout or not
-   `Winner` is the winner of the fight
-   `Stance` is the stance of the fighter (orthodox, southpaw, etc.)
-   `Height_cms` is the height in centimeter
-   `Reach_cms` is the reach of the fighter (arm span) in centimeter
-   `Weight_lbs` is the weight of the fighter in pounds (lbs)
-   `age` is the age of the fighter
-   `title_bout` Boolean value of whether it is title fight or not
-   `weight_class` is which weight class the fight is in (Bantamweight, heavyweight, Women's flyweight, etc.)
-   `no_of_rounds` is the number of rounds the fight was scheduled for
-   `current_lose_streak` is the count of current concurrent losses of the fighter
-   `current_win_streak` is the count of current concurrent wins of the fighter
-   `draw` is the number of draws in the fighter's ufc career
-   `wins` is the number of wins in the fighter's ufc career
-   `losses` is the number of losses in the fighter's ufc career
-   `total_rounds_fought` is the average of total rounds fought by the fighter
-   `total_time_fought(seconds)` is the count of total time spent fighting in seconds
-   `total_title_bouts` is the total number of title bouts taken part in by the fighter
-   `win_by_Decision_Majority` is the number of wins by majority judges decision in the fighter's ufc career
-   `win_by_Decision_Split` is the number of wins by split judges decision in the fighter's ufc career
-   `win_by_Decision_Unanimous` is the number of wins by unanimous judges decision in the fighter's ufc career
-   `win_by_KO/TKO` is the number of wins by knockout in the fighter's ufc career
-   `win_by_Submission` is the number of wins by submission in the fighter's ufc career
-   `win_by_TKO_Doctor_Stoppage` is the number of wins by doctor stoppage in the fighter's ufc career

# Data Exploration

```{r}
# Weight classes

ggplot(data_df, aes(x = weight_class)) +
  geom_bar(fill = "green4", color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Weight Classes", x = "Weight Class", y = "Count")
```

```{r}
# Fighting stance

ggplot(raw_fighter_df, aes(x = Stance)) +
  geom_bar(fill = "green4", color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Fighting Stance", x = "Stance", y = "Count")
```

```{r}
# Wins by decision

ggplot(raw_total_fight_df, aes(x = win_by)) +
  geom_bar(fill = "green4", color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Wins by Decision", x = "Win by", y = "Count")
```

```{r}
# Red Height vs Reach

ggplot(preprocessed_data_df, aes(x = R_Height_cms, y = R_Reach_cms)) +
  geom_point(color = "red") +
  theme_minimal() +
  labs(title = "Red Height vs Reach", x = "Height (cm)", y = "Reach (cm)") +
  theme(legend.position = "none")
```

```{r}

# Blue Height vs Reach

ggplot(preprocessed_data_df, aes(x = B_Height_cms, y = B_Reach_cms)) +
  geom_point(color = "blue") +
  theme_minimal() +
  labs(title = "Blue Height vs Reach", x = "Height (cm)", y = "Reach (cm)") +
  theme(legend.position = "none")
```

```{r}

# Red Weight vs Age

ggplot(preprocessed_data_df, aes(x = R_Weight_lbs, y = R_age)) +
  geom_point(color = "red") +
  theme_minimal() +
  labs(title = "Red Weight vs Age", x = "Weight (lbs)", y = "Age") +
  theme(legend.position = "none")
```

```{r}

# Blue Weight vs Age

ggplot(preprocessed_data_df, aes(x = B_Weight_lbs, y = B_age)) +
  geom_point(color = "blue") +
  theme_minimal() +
  labs(title = "Blue Weight vs Age", x = "Weight (lbs)", y = "Age") +
  theme(legend.position = "none")
```

```{r}
# Histogram of body strike takedown percentage

ggplot(preprocessed_data_df, aes(x =B_avg_TD_pct)) +
  geom_histogram(fill = "green4", color = "black") +
  theme_minimal()
```

```{r}
# Histogram of win by KO/TKO BY Red

ggplot(preprocessed_data_df, aes(x = `R_win_by_KO/TKO`)) +
  geom_histogram(fill = "red", color = "black") +
  theme_minimal()
```

```{r}

# Histogram of win by KO/TKO BY Blue
ggplot(preprocessed_data_df, aes(x = `B_win_by_KO/TKO`)) +
  geom_histogram(fill = "blue", color = "black") +
  theme_minimal()

```

```{r}

# Histogram of win by submission by Red

ggplot(preprocessed_data_df, aes(x = `R_win_by_Submission`)) +
  geom_histogram(fill = "red", color = "black") +
  theme_minimal()
```

```{r}


ggplot(preprocessed_data_df, aes(x = B_avg_SIG_STR_pct)) +
  geom_histogram(fill = "blue", color = "black") +
  theme_minimal()
```

```{r}

# significant strikes percentage By Blue vs Oppoenent

ggplot(preprocessed_data_df, aes(x = B_avg_SIG_STR_pct, y = B_avg_opp_SIG_STR_pct)) +
  geom_point(color = "blue") +
  theme_minimal() +
  facet_wrap(Winner~title_bout)
```

```{r}
# UFC event per year
library(lubridate)

data_df$date <- ymd(data_df$date)


ggplot(data_df, aes(x = year(date))) +
  geom_bar(fill = "green4", color = "black") +
  theme_minimal() +
  labs(title = "UFC Events per Year", x = "Year", y = "Count")


```

```{r}
# Distribution of age, Red


ggplot(preprocessed_data_df, aes(x = R_age)) +
  geom_histogram(fill = "red", color = "black") +
  theme_minimal()
```

```{r}

# Distribution of age, Blue

ggplot(preprocessed_data_df, aes(x = B_age)) +
  geom_histogram(fill = "blue", color = "black") +
  theme_minimal()
```

```{r}

# UFC fight out by Division

ggplot(raw_total_fight_df, aes(x= Fight_type, fill = win_by)) +
  geom_bar() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "UFC Fight Outcome by Division", x = "Division", y = "Count")
```

```{r}
preprocessed_data_df |>
  pivot_longer(cols = c(R_win_by_Decision_Majority, 
                        R_win_by_Decision_Split, 
                        R_win_by_Decision_Unanimous, 
                        `R_win_by_KO/TKO`, 
                        R_win_by_Submission, 
                        R_win_by_TKO_Doctor_Stoppage,
                        B_win_by_Decision_Majority,
                        B_win_by_Decision_Split,
                        B_win_by_Decision_Unanimous,
                        `B_win_by_KO/TKO`,
                        B_win_by_Submission,
                        B_win_by_TKO_Doctor_Stoppage),
               names_to = "Win_by", values_to = "Count") |>
  pivot_longer(cols = c(weight_class_Bantamweight,
                        weight_class_CatchWeight,
                        weight_class_Featherweight,
                        weight_class_Flyweight,
                        weight_class_Heavyweight,
                        weight_class_LightHeavyweight,
                        weight_class_Lightweight,
                        weight_class_Middleweight,
                        weight_class_OpenWeight,
                        weight_class_Welterweight,
                        weight_class_WomenBantamweight,
                        weight_class_WomenFeatherweight,
                        weight_class_WomenFlyweight,
                        weight_class_WomenStrawweight), 
               names_to = "Fight_type", values_to = "count2") |>
  ggplot(aes(x = Fight_type, y = count2, fill = Win_by)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "UFC Fight Outcome by Division", x = "Division", y = "Count") 

```

```{r}
# UFC fight outcome over the years

data_df |> 
  pivot_longer(cols = c(R_win_by_Decision_Majority, 
                        R_win_by_Decision_Split, 
                        R_win_by_Decision_Unanimous, 
                        `R_win_by_KO/TKO`, 
                        R_win_by_Submission, 
                        R_win_by_TKO_Doctor_Stoppage,
                        B_win_by_Decision_Majority,
                        B_win_by_Decision_Split,
                        B_win_by_Decision_Unanimous,
                        `B_win_by_KO/TKO`,
                        B_win_by_Submission,
                        B_win_by_TKO_Doctor_Stoppage),
               names_to = "Win_by", values_to = "Count") |>
  mutate(Win_by = str_replace_all(Win_by, c("R_" = "", "B_" = ""))) |>
  mutate(Win_by = as.factor(Win_by)) |>
  ggplot(aes(x=year(date), fill = Win_by)) +
  geom_bar() +
  labs(title = "UFC Fight Outcome Over the Years", x = "Year", y = "Count")



```

```{r}
# Line graph instead of bar graph

data_df |> 
  pivot_longer(cols = c(R_win_by_Decision_Majority, 
                        R_win_by_Decision_Split, 
                        R_win_by_Decision_Unanimous, 
                        `R_win_by_KO/TKO`, 
                        R_win_by_Submission, 
                        R_win_by_TKO_Doctor_Stoppage,
                        B_win_by_Decision_Majority,
                        B_win_by_Decision_Split,
                        B_win_by_Decision_Unanimous,
                        `B_win_by_KO/TKO`,
                        B_win_by_Submission,
                        B_win_by_TKO_Doctor_Stoppage),
               names_to = "Win_by", values_to = "Count") |>
  mutate(Win_by = str_replace_all(Win_by, c("R_" = "", "B_" = ""))) |>
  mutate(Win_by = as.factor(Win_by), year = year(date)) |>
  group_by(year, Win_by) |>
  summarise(Count = sum(Count), year) |>
  filter(row_number()==1) |>
  ggplot(aes(x=year, y = Count, color = Win_by)) +
  geom_line() +
  labs(title = "UFC Fight Outcome Over the Years", x = "Year", y = "Count")

```

```{r}

data_df |>
  pivot_longer(cols = c(R_Stance, B_Stance), 
               names_to = "Fighter_B_Or_R", 
               values_to = "Stance") |>
  mutate(Stance = as.factor(Stance), year = year(date)) |>
  group_by(year, Stance) |>
  summarise(Count = n(), year) |>
  filter(row_number()==1) |>
  ggplot(aes(x=year, y = Count, color = Stance)) +
  geom_line() +
  labs(title = "UFC Fighter Stance Popularity Over the Years", x = "Year", y = "Count") +
  theme_minimal()


```

# Shiny app

```{r}

# table of fighters

data_df |> 
  pivot_longer(cols = c(R_fighter, B_fighter), 
               names_to = "Fighter_Name", 
               values_to = "Fighter") |>
  filter(!is.na(Fighter)) 

```

```{r}
colnames(data_df)
```

```{r}

# Filter data for a specific fighter
fighter_data <- data_df |> 
  filter(R_fighter == "Conor McGregor" | B_fighter == "Conor McGregor") |>
  mutate(Date = as.Date(date)) |>
  select(Date, R_fighter, B_fighter, R_avg_SIG_STR_landed, B_avg_SIG_STR_landed, 
         R_avg_TD_landed, B_avg_TD_landed, `R_total_time_fought(seconds)`, `B_total_time_fought(seconds)`)

```

```{r}
library(shiny)
library(shinythemes)

choices_R <- data_df |>
  pull(R_fighter) |>
  unique()

choices_B <- data_df |>
  pull(B_fighter) |>
  unique()

choices <- union(choices_R, choices_B)

weights <- data_df |>
  pull(weight_class) |>
  unique()

ui <- fluidPage(
  theme = shinytheme("superhero"),
  titlePanel("Fighter Statistics Over Time"),
  sidebarLayout(
    sidebarPanel(
      selectInput("selectedFighter", "Select a Fighter",
                  choices = choices),
      radioButtons("selectedWeight", "Select a Weight Class",
                   choices = weights)
    ),
    mainPanel(
      plotOutput("statsPlot"),
      dataTableOutput("table")
    )
  )
)

```

```{r}
server <- function(input, output) {
  
  observeEvent(input$selectedWeight, {
    
    choices <- data_df |>
      filter(weight_class == input$selectedWeight) |>
      distinct(R_fighter, B_fighter) |>
      pull(R_fighter, B_fighter)
    
    updateSelectInput(inputId = "selectedFighter", choices = choices)
    
    
  })
  
  ufc_reactive <- reactive({
    
    # Filter data for a specific fighter
    fighter_data <- data_df |> 
      filter(R_fighter == input$selectedFighter | B_fighter == input$selectedFighter) |>
      mutate(Date = as.Date(date)) |>
      select(Date, R_fighter, B_fighter, 
             R_avg_SIG_STR_landed, B_avg_SIG_STR_landed, 
             R_avg_TD_landed, B_avg_TD_landed, 
             `R_total_time_fought(seconds)`, `B_total_time_fought(seconds)`)
    
    
    # Determine which corner the fighter was in and select the correct stats
    fighter_stats <- fighter_data |>
      mutate(SIG_STR_landed = if_else(R_fighter == input$selectedFighter, 
                                      R_avg_SIG_STR_landed, B_avg_SIG_STR_landed),
             TD_landed = if_else(R_fighter == input$selectedFighter, 
                                 R_avg_TD_landed, B_avg_TD_landed),
             Total_time_fought = if_else(
               R_fighter == input$selectedFighter, 
                                         `R_total_time_fought(seconds)`, `B_total_time_fought(seconds)`))
   
  })
  
  
  output$statsPlot <- renderPlot({
    
    
    # Plotting
    ggplot(ufc_reactive(), aes(x = Date)) +
      geom_line(aes(y = SIG_STR_landed, colour = "Significant Strikes Landed")) +
      geom_line(aes(y = TD_landed, colour = "Takedowns Landed")) +
      geom_line(aes(y = Total_time_fought, colour = "Total Time Fought")) +
      labs(title = glue::glue(input$selectedFighter, " Performance Over Time"), x = "Date", y = "Stat Value") +
      scale_color_manual(values = c("Significant Strikes Landed" = "blue", 
                                    "Takedowns Landed" = "red", "Total Time Fought" = "green")) +
      theme_minimal()
  })
  
  output$table <- renderDataTable({
    data_df |>
      filter(weight_class == input$selectedWeight) |>
      mutate(Date = as.Date(date)) |>
      select(Date, R_fighter, B_fighter, 
             R_avg_SIG_STR_landed, B_avg_SIG_STR_landed, 
             R_avg_TD_landed, B_avg_TD_landed, 
             `R_total_time_fought(seconds)`, `B_total_time_fought(seconds)`)
  })
}

```

```{r}
shinyApp(ui, server)
```


# Next possible steps
# Modelling?
# Map ?
# More interactivity?
# Fighterwise comparison?

# Logistic regression to predict fight outcomes

```{r}
# Logistic regression to predict fight outcomes

modified_df <- data_df |> 
  select(R_fighter, B_fighter, Winner, R_avg_SIG_STR_landed, B_avg_SIG_STR_landed, 
         R_avg_TD_landed, B_avg_TD_landed, R_avg_SIG_STR_pct, B_avg_SIG_STR_pct, 
         R_avg_TD_pct, B_avg_TD_pct, R_avg_SUB_ATT, B_avg_SUB_ATT, 
         R_avg_REV, B_avg_REV, R_avg_SIG_STR_att, B_avg_SIG_STR_att, 
         R_avg_TD_att, B_avg_TD_att, R_avg_TOTAL_STR_att, B_avg_TOTAL_STR_att, 
         R_avg_TD_landed, B_avg_TD_landed, R_avg_TOTAL_STR_landed, B_avg_TOTAL_STR_landed, 
         R_avg_opp_SIG_STR_landed, B_avg_opp_SIG_STR_landed, R_avg_opp_SIG_STR_att, 
         B_avg_opp_SIG_STR_att, R_avg_opp_TD_landed, B_avg_opp_TD_landed, 
         R_avg_opp_TD_att, B_avg_opp_TD_att, R_avg_opp_TOTAL_STR_landed, 
         B_avg_opp_TOTAL_STR_landed, R_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_att, 
         R_avg_opp_TD_pct, B_avg_opp_TD_pct, R_avg_opp_SIG_STR_pct, B_avg_opp_SIG_STR_pct, 
         R_avg_opp_SUB_ATT, B_avg_opp_SUB_ATT, R_avg_opp_REV, B_avg_opp_REV) |>
  mutate(R_win = if_else(Winner == "Red", 1, 0)) |>
  select(-Winner) |>
  mutate(R_win = as.factor(R_win)) |>
  pivot_longer(cols = c(R_avg_SIG_STR_landed, B_avg_SIG_STR_landed, 
                        R_avg_TD_landed, B_avg_TD_landed, 
                        R_avg_SIG_STR_pct, B_avg_SIG_STR_pct, 
                        R_avg_TD_pct, B_avg_TD_pct, 
                        R_avg_SUB_ATT, B_avg_SUB_ATT, 
                        R_avg_REV, B_avg_REV, 
                        R_avg_SIG_STR_att, B_avg_SIG_STR_att, 
                        R_avg_TD_att, B_avg_TD_att, 
                        R_avg_TOTAL_STR_att, B_avg_TOTAL_STR_att, 
                        R_avg_TD_landed, B_avg_TD_landed,
                        R_avg_TOTAL_STR_landed, B_avg_TOTAL_STR_landed,
                        R_avg_opp_SIG_STR_landed, B_avg_opp_SIG_STR_landed,
                        R_avg_opp_SIG_STR_att, B_avg_opp_SIG_STR_att,
                        R_avg_opp_TD_landed, B_avg_opp_TD_landed,
                        R_avg_opp_TD_att, B_avg_opp_TD_att,
                        R_avg_opp_TOTAL_STR_landed, B_avg_opp_TOTAL_STR_landed,
                        R_avg_opp_TOTAL_STR_att, B_avg_opp_TOTAL_STR_att,
                        R_avg_opp_TD_pct, B_avg_opp_TD_pct,
                        R_avg_opp_SIG_STR_pct, B_avg_opp_SIG_STR_pct,
                        R_avg_opp_SUB_ATT, B_avg_opp_SUB_ATT,
                        R_avg_opp_REV, B_avg_opp_REV),
               names_to = "Feature", values_to = "Value") |>
  mutate(Feature = as.factor(Feature)) |>
  filter(!is.na(Value))

mod1 <- glm(R_win ~ Feature + Value, data = modified_df, family = "binomial")

mod1 |> summary()
```

```{r}

# try model with only significant strikes landed and takedowns landed

modified_df <- data_df |> 
  select(R_fighter, B_fighter, Winner, R_avg_SIG_STR_landed, B_avg_SIG_STR_landed, 
         R_avg_TD_landed, B_avg_TD_landed) |>
  mutate(R_win = if_else(Winner == "Red", 1, 0)) |>
  select(-Winner) |>
  mutate(R_win = as.factor(R_win)) |>
  pivot_longer(cols = c(R_avg_SIG_STR_landed, B_avg_SIG_STR_landed, 
                        R_avg_TD_landed, B_avg_TD_landed),
               names_to = "Feature", values_to = "Value") |>
  mutate(Feature = as.factor(Feature)) |>
  filter(!is.na(Value))

mod2 <- glm(R_win ~ Feature + Value, data = modified_df, family = "binomial")

mod2 |> summary()
```


# map 

```{r}
## install.packages("maps")
library(maps)
library(tidyverse)
world_df <- ggplot2::map_data("world")
```


```{r}
# first split the location into city, state, country

ufc_world <- data_df |>
  separate(location, into = c("City", "State", "Country"), sep = ",")
```

```{r}
# how many unique countries are there in the dataset?

ufc_world |>
  select(Country) |>
  distinct()
```

```{r}
# how many fights have taken place in each country?

country_stat <- ufc_world |>
  group_by(Country) |>
  summarise(n = n()) |>
  arrange(desc(n))

country_stat
```

```{r}
# how many fights have taken place in each city?

ufc_world |>
  group_by(City) |>
  summarise(n = n()) |>
  arrange(desc(n))
```

```{r}
# how many fights have taken place in each state?

ufc_world |>
  group_by(State) |>
  summarise(n = n()) |>
  arrange(desc(n))
```

```{r}
country_stat$Country <- gsub("\"", "", country_stat$Country)

# Trim leading and trailing whitespace
country_stat$Country <- trimws(country_stat$Country)

head(country_stat$Country)
```


```{r}

world_full <- left_join(world_df, country_stat, by = c("region" = "Country"))

ggplot(data = world_full, aes(x = long, y = lat, group = group, fill = n)) +
  geom_polygon(color = "black") +
  coord_fixed(1.3) +
  theme_void() +
  scale_fill_viridis_c(option = "plasma", na.value = "grey90") +
  labs(title = "Number of UFC Fights by Country",
       fill = "Number of Fights") +
  theme(legend.position = "bottom")
```

```{r}
# state level

state_stat <- ufc_world |>
  group_by(State) |>
  summarise(n = n()) |>
  arrange(desc(n))

state_stat$State <- gsub("\"", "", state_stat$State)

# Trim leading and trailing whitespace
state_stat$State <- trimws(state_stat$State)

head(state_stat$State)
```

```{r}
state_df <- ggplot2::map_data("state")

state_stat <- state_stat |>
  mutate(State = tolower(State))

state_full <- left_join(state_df, state_stat, by = c("region" = "State"))

ggplot(data = state_full, aes(x = long, y = lat, group = group, fill = n)) +
  geom_polygon(color = "black") +
  coord_fixed(1.3) +
  theme_void() +
  scale_fill_viridis_c(option = "plasma", na.value = "grey90") +
  labs(title = "Number of UFC Fights by State",
       fill = "Number of Fights") +
  theme(legend.position = "bottom")
```

```{r}
# city level

city_stat <- ufc_world |>
  group_by(City) |>
  summarise(n = n()) |>
  arrange(desc(n))

city_stat$City <- gsub("\"", "", city_stat$City)

# Trim leading and trailing whitespace
city_stat$City <- trimws(city_stat$City)

head(city_stat$City)
```

```{r}
my_cities <- maps::world.cities

usa_cities <- filter(my_cities,country.etc == "USA")

head(usa_cities)

```

```{r}

city_full <- left_join(usa_cities, city_stat, by = c("name" = "City"))

```

```{r}
usa <- map_data("usa")
```

```{r}
ggplot(data = usa, aes(x = long, y = lat, group = group)) +
  geom_polygon(color = "black", fill = "white") +
  geom_point(data = city_full, aes(x = long, y = lat, size = n, group = NULL), color = "red") +
  coord_fixed(1.3) +
  theme_void() +
  labs(title = "Number of UFC Fights by City",
       size = "Number of Fights")
```


# Shiny app for fighter wise comparison

```{r}
library(shiny)

ui <- fluidPage(
  titlePanel("UFC Fighter Comparison"),
  sidebarLayout(
    sidebarPanel(
      selectInput("fighter1", "Fighter 1", choices = unique(data_df$R_fighter)),
      selectInput("fighter2", "Fighter 2", choices = unique(data_df$R_fighter)),
      actionButton("submit", "Submit")
    ),
    mainPanel(
      textOutput("result")
    )
  )
)

server <- function(input, output) {
  
  fighter1 <- reactive({
    data_df |>
      filter(R_fighter == input$fighter1) |>
      select(R_fighter, R_avg_SIG_STR_landed, R_avg_TD_landed) |>
      head(1)
  })
  
  fighter2 <- reactive({
    data_df |>
      filter(R_fighter == input$fighter2) |>
      select(R_fighter, R_avg_SIG_STR_landed, R_avg_TD_landed) |>
      head(1)
  })
  
  output$result <- renderText({
    if(input$submit == 0) {
      return("Please select two fighters and click submit")
    }
    
    fighter1_data <- fighter1()
    fighter2_data <- fighter2()
    
    
  })
  
}

shinyApp(ui = ui, server = server)
```



